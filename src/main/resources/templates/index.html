<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #chat { border: 1px solid #ccc; padding: 10px; width: 500px; height: 400px; overflow-y: scroll; }
        #messageInput { width: 400px; }
        #sendBtn { width: 80px; }
        #usernameInput { width: 200px; margin-bottom: 10px; }
    </style>
</head>
<body>

<h2>Chat App</h2>

<!-- Username input field -->
<div>
    <input type="text" id="usernameInput" placeholder="Enter your name" />
</div>

<div id="chat"></div>

<input type="text" id="messageInput" placeholder="Type a message...">
<button id="sendBtn">Send</button>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    let stompClient = null;
    let username = '';

    // Function to set the username
    function setUsername() {
        username = document.getElementById('usernameInput').value.trim();
        if (username) {
            document.getElementById('usernameInput').style.display = 'none';  // Hide username input
            document.getElementById('messageInput').style.display = 'block';  // Show message input
            document.getElementById('sendBtn').style.display = 'block';  // Show send button
            connect();
        } else {
            alert('Please enter a username');
        }
    }

    function connect() {
        const socket = new SockJS('http://localhost:8080/ws'); // connects to /ws endpoint
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);

            // Subscribe to /topic/messages to receive chat messages
            stompClient.subscribe('/topic/messages', function (messageOutput) {
                showMessage(JSON.parse(messageOutput.body));
            });
        });
    }

    function sendMessage() {
        const messageContent = document.getElementById('messageInput').value.trim();
        if (messageContent && stompClient && username) {
            const chatMessage = {
                sender: username,
                content: messageContent
            };
            stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
            document.getElementById('messageInput').value = '';
        }
    }

    function showMessage(message) {
        const chat = document.getElementById('chat');
        const msgElement = document.createElement('div');
        msgElement.innerHTML = `<b>${message.sender}:</b> ${message.content}`;
        chat.appendChild(msgElement);
        chat.scrollTop = chat.scrollHeight; // scroll to bottom
    }

    document.getElementById('sendBtn').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendMessage();
    });

    // Call setUsername when the user enters their name
    document.getElementById('usernameInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') setUsername();
    });

    // Show the username input field initially
    document.getElementById('messageInput').style.display = 'none';
    document.getElementById('sendBtn').style.display = 'none';
</script>

</body>
</html>


<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Chat App</title>-->
<!--    <style>-->
<!--        body { font-family: Arial, sans-serif; margin: 20px; }-->
<!--        #chat { border: 1px solid #ccc; padding: 10px; width: 500px; height: 400px; overflow-y: scroll; }-->
<!--        #messageInput { width: 400px; }-->
<!--        #sendBtn { width: 80px; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<h2>Chat App</h2>-->

<!--<div id="chat"></div>-->

<!--<input type="text" id="messageInput" placeholder="Type a message...">-->
<!--<button id="sendBtn">Send</button>-->

<!--<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>-->
<!--<script>-->
<!--    let stompClient = null;-->

<!--    function connect() {-->
<!--       const socket = new SockJS('http://localhost:8080/ws');  // Use the correct WebSocket endpoint-->
<!-- // connects to /ws endpoint-->
<!--        stompClient = Stomp.over(socket);-->

<!--        stompClient.connect({}, function (frame) {-->
<!--            console.log('Connected: ' + frame);-->

<!--            // Subscribe to /topic/messages to receive chat messages-->
<!--            stompClient.subscribe('/topic/messages', function (messageOutput) {-->
<!--                showMessage(JSON.parse(messageOutput.body));-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function sendMessage() {-->
<!--        const messageContent = document.getElementById('messageInput').value.trim();-->
<!--        if(messageContent && stompClient) {-->
<!--            const chatMessage = {-->
<!--                sender: "User",  // You can make this dynamic later-->
<!--                content: messageContent-->
<!--            };-->
<!--            stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));-->
<!--            document.getElementById('messageInput').value = '';-->
<!--        }-->
<!--    }-->

<!--    function showMessage(message) {-->
<!--        const chat = document.getElementById('chat');-->
<!--        const msgElement = document.createElement('div');-->
<!--        msgElement.innerHTML = `<b>${message.sender}:</b> ${message.content}`;-->
<!--        chat.appendChild(msgElement);-->
<!--        chat.scrollTop = chat.scrollHeight; // scroll to bottom-->
<!--    }-->

<!--    document.getElementById('sendBtn').addEventListener('click', sendMessage);-->
<!--    document.getElementById('messageInput').addEventListener('keypress', function (e) {-->
<!--        if(e.key === 'Enter') sendMessage();-->
<!--    });-->

<!--    connect();-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
